---
layout: base.liquid

pagination:
  data: pitakaData
  size: 1
  alias: entry
  addAllPagesToCollections: true

permalink: '/pitaka/{{ entry.scx_path }}/index.html'
eleventyComputed:
  title: '{{ entry.original_title | default: entry.root_name }}—{{ entry.translated_title | default: entry.translated_name }}'
  json_ld: '{{ entry.scx_json_ld }}'
  og_tags: '{{ entry.scx_og_tags }}'
---
<header>
  {% assign parts = entry.scx_breadcrumb | split: "/" %}
  {% capture breadcrumbsList %}
    {% for part in parts %}
      {% assign path = path | append: '/' | append: part %}
      <li>
        {% if forloop.last %}
          <span aria-current="page">{{ part }}</span>
        {% else %}
          <a href="/pitaka{{ path }}">{{ part }}</a>
        {% endif %}
      </li>
    {% endfor %}
  {% endcapture %}
  {% include "headerNav.liquid", breadcrumbsList: breadcrumbsList %}
</header>

<main>
  <h1>{{ title }}</h1>

  <p>{{ entry.blurb }}</p>

  {% if entry.children.length %}
    <ul>
      {% for child in entry.children %}
        <li>
          <!--
            Check when the nested menu link should change to the root level chapter link,
            while accounting for the unusual breaks for pātimokkha texts,
            to sync URL structure with SuttaCentral.net
          -->
          {% capture pitaka_url %}false{% endcapture %}
          {% if child.children.size > 0 %}
            {% for grandchild in child.children %}
              {% if grandchild.node_type == "branch" %}
                {% capture pitaka_url %}true{% endcapture %}
              {% endif %}
            {% endfor %}
          {% endif %}
          {% if child.uid | endswith: '-pm' %}
            {% capture pitaka_url %}false{% endcapture %}
          {% endif %}
          <h2>
            <a href="{% if pitaka_url == 'false' %}/{{ child.uid }}/{% else %}/pitaka/{{ entry.scx_path }}/{{ child.uid }}/{% endif %}">
              {{ child.original_title | default: child.root_name -}}
              {%- if child.translated_title or child.translated_name -%}
                —{{ child.translated_title | default: child.translated_name -}}
              {%- endif %}
            </a>
          </h2>
          {% if child.blurb %}
            <p>{{ child.blurb }}</p>
          {% endif %}
        </li>
      {% endfor %}
    </ul>
  {% endif %}
</main>

{% assign path = "pitaka/" | append: entry.scx_path %}
{% include "footer.liquid", route: path, fetchedAt: entry.scx_fetched_at %}

{% if _siteMetaData.environment == "dev" %}
  <script>
    const data = {{ entry | jsonify }};
    console.log(data);
  </script>
{% endif %}
