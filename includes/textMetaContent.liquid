<!-- This has it's own file because it's used in text.liquid as well -->
<h1>{{ title }}</h1>

<p>{{ entry.blurb }}</p>

<section class="texts-list">
  {% if translations.length %}
    {% assign english_versions = translations | where: 'lang', 'en' %}
    {% if english_versions.size > 0 %}
      <details open>
        <summary>
          English translation{% if english_versions.size > 1 %}s{% endif %}
          <span class="sr-only">({{ english_versions.size }} available)</span>
        </summary>
        <ul>
          {% for version in english_versions %}
            <li>
              <a
                href="/{{ entry.uid }}/{{ version.lang }}/{{ version.author_uid }}"
                hreflang="{{ version.lang }}"
              >
                {{-
                  version.author
                  | default: version.author_uid
                  | replace: '&nbsp;', ' '
                  | replace: '&#160;', ' '
                  | replace: '\u00A0', ' '
                  | strip
                -}}
              </a>
              {%- if version.publication_date -%}
                &nbsp;(<span>{{ version.publication_date }}</span>)
              {%- endif %}
            </li>
          {% endfor %}
        </ul>
      </details>
    {% endif %}

    {% assign root_versions = translations
      | where: 'is_root', true
      | reject: 'lang', 'en'
    %}
    {% if root_versions.size > 0 %}
      <details open>
        <summary>
          Edition{% if root_versions.size > 1 %}s{% endif %} of the root text
        </summary>
        <ul>
          {% for version in root_versions %}
            <li>
              <span>{{ version.lang_name }}—</span
              ><a
                href="/{{ entry.uid }}/{{ version.lang }}/{{ version.author_uid }}"
                hreflang="{{ version.lang }}"
              >
                {{-
                  version.author
                  | default: version.author_uid
                  | replace: '&nbsp;', ' '
                  | replace: '&#160;', ' '
                  | replace: '\u00A0', ' '
                  | strip
                -}}
              </a>
              {%- if version.publication_date -%}
                &nbsp;(<span>{{ version.publication_date }}</span>)
              {%- endif %}
            </li>
          {% endfor %}
        </ul>
      </details>
    {% endif %}

    {% assign remaining_versions = translations %}
    {% assign remaining_versions = remaining_versions
      | reject: 'lang', 'en'
      | reject: 'is_root', true
    %}
    {% if remaining_versions.size > 0 %}
      <details>
        <summary>
          Translations in other modern languages (
          {{- remaining_versions.size -}}
          )
        </summary>
        <ul>
          {% for version in remaining_versions %}
            <li>
              <span>{{ version.lang_name }}—</span
              ><a
                href="/{{ entry.uid }}/{{ version.lang }}/{{ version.author_uid }}"
                hreflang="{{ version.lang }}"
              >
                {{-
                  version.author
                  | default: version.author_uid
                  | replace: '&nbsp;', ' '
                  | replace: '&#160;', ' '
                  | replace: '\u00A0', ' '
                  | strip
                -}}
              </a>
              {%- if version.publication_date -%}
                &nbsp;(<span>{{ version.publication_date }}</span>)
              {%- endif %}
            </li>
          {% endfor %}
        </ul>
      </details>
    {% endif %}
  {% endif %}

  {% if entry._parallels_data and entry._parallels_data.size > 0 %}
    {% assign totalParallels = 0 %}
    {% for key in entry._parallels_data %}
      {% assign totalParallels = totalParallels | plus: key[1].size %}
    {% endfor %}
    <details>
      <summary>Parallels ({{ totalParallels }})</summary>
      <ul>
        {% for segment in entry._parallels_data %}
          <li>
            {{ segment[0] }}
            <ul>
              {% for parallel in segment[1] %}
                <li>
                  {% if parallel.to.translations.size > 0 %}
                    <a
                      href="/{{ parallel.to.uid }}/{{ parallel.to.translations[0].lang }}/{{ parallel.to.translations[0].author_uid }}{% if parallel.to.to contains '#' %}#{{ parallel.to.to | split: '#' | last }}{% endif %}"
                      hreflang="{{ parallel.to.translations[0].lang }}"
                    >
                      {{
                        parallel.to.translated_title
                        | default: parallel.to.original_title
                        | default: parallel.to.acronym
                        | strip
                      }}
                    </a>
                  {% else %}
                    <span>
                      {{
                        parallel.to.translated_title
                        | default: parallel.to.original_title
                        | default: parallel.to.acronym
                        | strip
                      }}
                    </span>
                  {% endif %}
                  <br>
                  {% if parallel.to.translated_title
                    and parallel.to.original_title
                  %}
                    {{ parallel.to.original_title | strip }} |
                    {{ parallel.to.acronym | strip }} |
                    {{ parallel.to.volpages | strip }}
                  {% elsif parallel.to.original_title %}
                    {{ parallel.to.acronym | strip }} |
                    {{ parallel.to.volpages | strip }}
                  {% elsif parallel.to.acronym %}
                    {{ parallel.to.volpages | strip }}
                  {% endif %}
                </li>
              {% endfor %}
            </ul>
          </li>
        {% endfor %}
      </ul>
    </details>
  {% endif %}
</section>
